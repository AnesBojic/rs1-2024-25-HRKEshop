<div class="product-container" (scroll)="onDivScroll($event)">

  <div class="header">
    <h2>{{ 'PRODUCT.TITLE_CREATE' | translate }}</h2>

    <div class="header-actions">
      <button class="btn-add" (click)="goToNewProduct()">
        {{ 'PRODUCT.BUTTON_ADD' | translate }}
      </button>

      <button class="btn-toggle-scroll" (click)="toggleScrollMode()">
        <span class="icon">üîÅ</span>
        {{ isInfiniteScroll ? 'Switch to Pagination' : 'Switch to Infinite Scroll' }}
      </button>
    </div>
  </div>

  <div class="filters">

    <input type="text"
           placeholder="üîç {{ 'PRODUCT.NAME_LABEL' | translate }}"
           [(ngModel)]="filters.q"
           (ngModelChange)="loadProducts(1)" />

    <select [(ngModel)]="filters.gender" (ngModelChange)="loadProducts(1)">
      <option [ngValue]="undefined">{{ 'PRODUCT.GENDER_LABEL' | translate }}</option>
      <option [ngValue]="1">{{ 'PRODUCT.MALE' | translate }}</option>
      <option [ngValue]="2">{{ 'PRODUCT.FEMALE' | translate }}</option>
      <option [ngValue]="3">{{ 'PRODUCT.OTHER' | translate }}</option>
    </select>

    <select [(ngModel)]="filters.brandId" (ngModelChange)="loadProducts(1)">
      <option [ngValue]="undefined">{{ 'PRODUCT.BRAND_LABEL' | translate }}</option>
      <option *ngFor="let brand of brands" [ngValue]="brand.id">{{ brand.name }}</option>
    </select>

    <select [(ngModel)]="filters.colorId" (ngModelChange)="loadProducts(1)">
      <option [ngValue]="undefined">{{ 'PRODUCT.COLOR_LABEL' | translate }}</option>
      <option *ngFor="let color of colors" [ngValue]="color.id">{{ color.name }}</option>
    </select>

    <input type="number"
           placeholder="{{ 'PRODUCT.PRICE_LABEL' | translate }} (min)"
           [(ngModel)]="filters.minPrice"
           (ngModelChange)="loadProducts(1)" />

    <input type="number"
           placeholder="{{ 'PRODUCT.PRICE_LABEL' | translate }} (max)"
           [(ngModel)]="filters.maxPrice"
           (ngModelChange)="loadProducts(1)" />
  </div>

  <div class="products-grid">
    <div class="product-card" *ngFor="let p of products">
      <img [src]="getProductImageUrl(p)"
           (error)="onImageError($event)"
           alt="{{ p.name }}" />

      <div class="card-body">
        <h3>{{ p.name }}</h3>
        <p class="price">{{ p.price | currency:'BAM':'symbol' }}</p>
      </div>

      <div class="card-actions">
        <button class="btn-edit" (click)="editProduct(p.id)">
          {{ 'PRODUCT.BUTTON_EDIT' | translate }}
        </button>
        <button class="btn-delete" (click)="deleteProduct(p.id)">
          {{ 'PRODUCT.BUTTON_DELETE' | translate }}
        </button>
      </div>
    </div>
  </div>

  <div class="pagination" *ngIf="!isInfiniteScroll">
    <button [disabled]="currentPage === 1"
            (click)="loadProducts(currentPage - 1)">
      {{ 'PRODUCT.PAG_PREVIOUS' | translate }}
    </button>

    <span>{{ 'PRODUCT.PAGINATION' | translate }} {{ currentPage }} / {{ totalPages }}</span>

    <button [disabled]="currentPage === totalPages"
            (click)="loadProducts(currentPage + 1)">
      {{ 'PRODUCT.PAG_NEXT' | translate }}
    </button>
  </div>

  <div class="loading-spinner" *ngIf="isInfiniteScroll && isLoading" style="width: 100%; text-align: center; padding: 20px; clear: both;">
    <p style="font-size: 1.2rem; color: #666;">‚è≥ Loading more products...</p>
  </div>

  <div class="end-list-msg" *ngIf="isInfiniteScroll && !isLoading && currentPage >= totalPages && products.length > 0" style="width: 100%; text-align: center; padding: 20px; clear: both;">
    <p style="color: #888;">üèÅ No more products to show.</p>
  </div>

  <div class="no-data" *ngIf="products.length === 0 && !isLoading" style="text-align: center; padding: 40px;">
    <p>No products found matching your criteria.</p>
  </div>

</div>
